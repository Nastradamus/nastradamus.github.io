---
layout: post
title: "iotop and PostgreSQL (lie story)"
---

I see a lot of PostgreSQL articles with `iotop` screenshots.  
But I think `iotop` and `pidstat` are useless tools if you want to understand PostgreSQL I/O.  
Just run a [Nancy](http://gitlab.com/postgres.ai/nancy/) (PostgreSQL 'experiments' tool)  test where postgres generates a lot of disk workload.  
Just look at this screenshot:  
![iotop megabytes]({{ site.baseurl }}http://nastradamus.github.io/images/iotop/iotop_lie_megabytes.png "iotop megabytes")  
We see `Actual DISK WRITE` is 18.79 M/s, but the summarized I/O of "all tasks" is above 3 M/s.  

...and at another one screen:  
![iotop percents]({{ site.baseurl }}http://nastradamus.github.io/images/iotop/iotop_lie_percent.png "iotop percents")  

`%` column lies! Every of the top *postgres-related* processes shows I/O greater then `90%`.

### Why it happens?

According to actual Linux kernel documentation [Linux kernel documentation](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/Documentation/filesystems/proc.txt?h=v4.9.150#n1511), `/procfs/` don't know real statistics about written bytes or chars.

And the real problem is: `/proc/<pid>/io` not showing I/O with [mmap()'ed files](https://stackoverflow.com/questions/3633286/what-do-the-counters-in-proc-pid-io-mean#comment92260839_3634088) (please specify correct source in commnets).

As I said before, you easily can check it with [Nancy](http://gitlab.com/postgres.ai/nancy/).

Of course `iotop` and `pidstat` use `/procfs/` (just open `man iotop`).

### Conclusion

Stop using `iotop` in postgres-related articles.  

For Linux distro maintainers: please, add more abilities to understand real disk I/O from scratch. `/proc/<pid>/io` is useless.

*About Author*  

*Victor Yagofarov  
victor@postgres.ai  
Telegram: @nas_tradamus*

